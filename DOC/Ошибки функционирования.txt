    Фиксация и обработка ошибок в системе учета отпуска нефтепродуктов.

     Состояние регистра ошибок равное 0 означает отсутствие ошибок
   в соответствующем регистре.

    При возникновении ошибки, код ошибки фиксируется в соответствующем регистре
   и остается там до получения команды очистки ошибок. До очистки ошибок работа
   системы блокируется.

    Реакция системы верхнего уровня на ошибку: необходимо отобразить оператору
  и зафиксировать в журнале событий дату,время,номер стояка, наименование
  регистра(ов) в котором(ых) зафиксирована(ы) ошибка(и) и тип ошибки.

   Оператору следует устранить причину аварийной ситуации исходя из типа ошибки.
   Далее дождаться от оператора команды на очистку ошибки(ок),
 после чего выдать команду очистки ошибок на соответствующий стояк.

   Если после сброса ошибок, ошибки фиксируются снова (не сбрасываются)
  оператору необходимо связаться с сервисной организацией.

   В данной версии имитируется безаварийное состояние следующих сигналов цепи безопасности
  (поскольку они не заведены на дискретные входы контроллера):

   аварийных кнопок,
   УЗА (Устройство Заземления Автоцистерны),
   трап,
   консоль, 
   датчика предельного уровня при верхнем наливе.

 Кодировка ошибок функционирования:

    Битовая кодировка регистра ошибок I10:

    При наличии ошибки соответствующий бит устанавливается.
    I10 == 0 - ошибок нет.

       D0...D3 - ошибка, биткодированная по модулям
          D0 - Расходомер
          D1 - Модуль дискретного ввода-вывода N1 (I7044)
          D2 - Модуль аналогового ввода-вывода N2 (I7017)
          D3 - Другие модули

         D4...D15 - ошибка функционирования,

        0x0010 - нет сигнала УЗА при отпуске
        0x0020 - консоль не в рабочем положении
        0x0040 - трап не в рабочем положении
        0x0080 - не корректный ID процессора
        0x0100  - зафиксирован предельный уровень в бензовозе при отпуске.
        0x0200  - нажата аварийная кнопка
        0x0400 - логическая ошибка связи с расходомером
        0x0800 - ошибка при конфигурировании расходомера
        0x1000 - ошибка контрольной суммы EEPROM
        0x2000 - ошибка записи во FLASH
        0x4000 - таймаут связи с базой ( таймаут по приему команды)
        0x8000 - прочие ошибки.

        0x8010 - Команда аварийного останова от Host
        0x8020 - При старте налива зафиксирована утечка до открывания
                 отсечного клапана
        0x8030 - Насос не развивает давление при старте
        0x8040 - При завершении налива зафиксирована утечка после закрывания
                 отсечного клапана
        0x8070 - Не закрыта задвижка верхнего налива при отсутствии отпуска
        0x8080 - Не закрыта задвижка нижнего  налива при отсутствии отпуска



---------------------------
    Кодировка регистра ошибок I11:

   0x1             Ошибка CRC EEPROM процессора
   0x2             Ошибка стирания FLASH
   0x4             Ошибка записи во FLASH
   0x10            Расходомер не обнулил массу/объем
   0x20            Нет обновл.данных для журнала
   0x40            При старте налива зафиксирована утечка до открывания
                   отсечного клапана
   0x80            Насос не развивает давление
   0x100           Ошибка привода насоса при торможении
   0x101           Авария от HOST
   0x200           Сторожевой таймер HOST
   0x201           Останов привода насоса при отпуске
   0x400           При завершении налива зафиксирована утечка после закрывания
                   отсечного клапана
   0x401           Драйверы MVD,7060 не включены
   0x800           Нажата аварийная кнопка (ES) при отпуске
   0x1000          Разорвана цепь безопасности. Код ошибки находится
                   в регистре I12.
   0x2000          Нет связи с расходомером
   0x4000          Ошибка конфигурирования расходомера при включении
   0x8004          Не закрыта задвижка верхнего налива при отсутствии отпуска
   0x8008          Не закрыта задвижка нижнего  налива при отсутствии отпуска


При  I11=0x1000,
    I12:
         2         Нет УЗА при отпуске
         3         Уровень в автоцистерне выше допустимого
         6         Консоль не в раб.позиции
         7         Трап не в раб.позиции
         8         Некорректный ID процессора


I13...I16  Для соответствующих периферийных устройств:
 D0...D7
   1               Ошибка чтения устройства
   2               Ошибка записи в устройство
   4               Ошибка Watch Dog (только для I14)

   8               Ошибка в устройстве, код ошибки устройства в старшем байте
                   
Названия драйверов устройств при индикации ошибок в соответствующем драйвере на ВРФ:

I7017  - драйвер модуля ICP 7017 (аналоговый ввод)
I7044  - драйвер модуля ICP 7044 (дискретный ввод-вывод)
MMI - дисплей ВРФ
MVD - расходомер Micromotion
OFP - Контроллер ограничения наполнения жидким топливом
TSD - трехстрочный дисплей 
---------------------------------
